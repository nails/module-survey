(()=>{"use strict";class t{constructor(t,e,a,s,r){this.adminController=t,this.charts=e,this.$container=a,this.surveyId=s,this.accessToken=r,$(".js-field .js-chart-type select",this.$container).each(((t,e)=>{$(e).empty();for(let t=0;t<this.charts.length;t++)$(e).append($("<option>").val(t).text(this.charts[t].getLabel())).trigger("change")}));let n,i=[];for(let t=0;t<this.charts.length;t++)$.merge(i,this.charts[t].getPackages());i=i.filter(((t,e,a)=>e===a.indexOf(t))),google.charts.load("current",{packages:i}),google.charts.setOnLoadCallback((()=>{this.loadStats()})),$(".js-response input",this.$container).on("click",(()=>{this.loadStats()})),$(".js-chart-target",this.$container).on("draw",(t=>{this.drawChart($(t.currentTarget))})),$(".js-chart-type select",this.$container).on("change",(t=>{$(t.currentTarget).closest(".js-field").find(".js-chart-target").data("chart-type",$(t.currentTarget).val()).trigger("draw")})),$(window).on("resize",(()=>{clearTimeout(n),n=setTimeout((()=>{$(".js-chart-target",this.$container).trigger("draw")}),250)})),$(".js-hide-respondents",this.$container).on("click",(()=>{$(".js-respondents > *",this.$container).each(((t,e)=>{$(e).attr("style","width:"+$(e).outerWidth()+"px!important;")})),$(".js-respondents, .js-stats",this.$container).addClass("respondents-hidden"),setTimeout((()=>{$(".js-chart-target",this.$container).trigger("draw")}),500)})),$(".js-show-respondents",this.$container).on("click",(()=>{$(".js-respondents, .js-stats",this.$container).removeClass("respondents-hidden"),setTimeout((()=>{$(".js-respondents > *",this.$container).removeAttr("style"),$(".js-chart-target",this.$container).trigger("draw")}),500)}))}loadStats(){let t=[];return $(".js-response input:checked",this.$container).each(((e,a)=>{t.push(parseInt($(a).val(),10))})),t.length>0&&$(".js-field",this.$container).each(((e,a)=>{let s=$(a),r=s.find(".js-loading"),n=s.find(".js-error"),i=s.find(".js-targets");n.addClass("hidden");let d=setTimeout((()=>{r.removeClass("hidden")}),250);$.ajax({url:window.SITE_URL+"api/survey/survey/stats",data:{survey_id:this.surveyId,access_token:this.accessToken,field_id:s.data("id"),response_ids:t.join(",")}}).always((()=>{clearTimeout(d),r.addClass("hidden")})).done((t=>{let e=s.find(".js-chart-target"),a=s.find(".js-text-target"),r=s.find(".js-chart-type"),n=r.find("select").val();if(s.find(".js-response-count").text(t.meta.response_count),e.data("chart-data",t.data.chart),e.data("chart-type",n),i.removeClass("hidden"),t.data.chart.length>0?(e.trigger("draw"),r.removeClass("hidden"),e.removeClass("hidden")):(r.addClass("hidden"),e.addClass("hidden")),a.empty(),t.data.text.length>0){for(let e=0;e<t.data.text.length;e++){let s=$("<li>").html(t.data.text[e]);a.append(s)}a.removeClass("hidden")}else a.addClass("hidden")})).fail((t=>{let e;try{e=JSON.parse(t.responseText)}catch(t){e={status:500,error:"An unknown error occurred."}}n.html(e.error).removeClass("hidden")}))})),this}drawChart(t){t.empty();let e=t.data("chart-data"),a=t.data("chart-type"),s={height:400,title:""},r=t.closest(".js-field").find(".js-error");if(this.charts[a]){for(let r=0;r<e.length;r++){let n=$("<div>").addClass("media-screen"),i=$("<img>").addClass("media-print");t.append(n).append(i);let d=new google.visualization.DataTable;for(let t=0;t<e[r].columns.length;t++)d.addColumn(e[r].columns[t][0],e[r].columns[t][1]);d.addRows(e[r].rows),s.title=e[r].title||"",this.charts[a].draw(n,i,d,s,e)}r.addClass("hidden")}else r.html("Invalid chart type.").removeClass("hidden");return this}}const e=class{getLabel(){return"Pie Chart"}getPackages(){return["corechart"]}draw(t,e,a,s){s.is3D=!0;var r=new google.visualization.PieChart(t.get(0));r.draw(a,s),e.attr("src",r.getImageURI())}},a=class{getLabel(){return"Bar Chart"}getPackages(){return["corechart"]}draw(t,e,a,s){var r=new google.visualization.BarChart(t.get(0));r.draw(a,s),e.attr("src",r.getImageURI())}},s=class{getLabel(){return"Column Chart"}getPackages(){return["corechart"]}draw(t,e,a,s){var r=new google.visualization.ColumnChart(t.get(0));r.draw(a,s),e.attr("src",r.getImageURI())}};new class{constructor(t,e){this.adminController=t,this.charts=e,this.loadGoogleLibraries((()=>{this.init()}))}loadGoogleLibraries(t){let e=document.createElement("script");e.onload=t,e.src="https://www.gstatic.com/charts/loader.js",document.head.appendChild(e)}init(){$(".group-survey.responses, .nails-survey.stats").each(((e,a)=>{let s=$(a);$(a).data("instance",new t(this.adminController,this.charts,s,s.data("survey-id"),s.data("survey-token")))}))}}((function(){return{log:function(){},warn:function(){},error:function(){}}}),(new class{get(){return[new e,new a,new s]}}).get())})();