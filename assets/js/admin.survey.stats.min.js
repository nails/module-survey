var _ADMIN_SURVEY_STATS;_ADMIN_SURVEY_STATS=function(t,e){var s=this;return s.surveyId=t,s.accessToken=e,s.charts=[],s.__construct=function(){for(var t in window.NAILS.ModuleSurvey.charts)window.NAILS.ModuleSurvey.charts.hasOwnProperty(t)&&s.charts.push(new window.NAILS.ModuleSurvey.charts[t]);$(".js-field .js-chart-type select").each(function(){$(this).empty();for(var t=0;t<s.charts.length;t++)$(this).append($("<option>").val(t).text(s.charts[t].label)).trigger("change")});for(var e=[],a=0;a<s.charts.length;a++)$.merge(e,s.charts[a].packages);e=e.filter(function(t,e,s){return e===s.indexOf(t)}),google.charts.load("current",{packages:e}),google.charts.setOnLoadCallback(function(){s.loadStats()}),$(".js-response input").on("click",function(){s.loadStats()}),$(".js-chart-target").on("draw",function(){s.drawChart($(this))}),$(".js-chart-type select").on("change",function(){$(this).closest(".js-field").find(".js-chart-target").data("chart-type",$(this).val()).trigger("draw")});var n;return $(window).on("resize",function(){clearTimeout(n),n=setTimeout(function(){$(".js-chart-target").trigger("draw")},250)}),$(".js-hide-respondents").on("click",function(){$(".js-respondents > *").each(function(){$(this).attr("style","width:"+$(this).outerWidth()+"px!important;")}),$(".js-respondents, .js-stats").addClass("respondents-hidden"),setTimeout(function(){$(".js-chart-target").trigger("draw")},500)}),$(".js-show-respondents").on("click",function(){$(".js-respondents, .js-stats").removeClass("respondents-hidden"),setTimeout(function(){$(".js-respondents > *").removeAttr("style"),$(".js-chart-target").trigger("draw")},500)}),s.initCopyButtons(),s},s.loadStats=function(){var t=[];return $(".js-response input:checked").each(function(){t.push(parseInt($(this).val(),10))}),t.length>0&&$(".js-field").each(function(){var e=$(this),a=e.find(".js-loading"),n=e.find(".js-error"),r=e.find(".js-targets");n.addClass("hidden");var d=setTimeout(function(){a.removeClass("hidden")},250);$.ajax({url:window.SITE_URL+"api/survey/survey/stats",data:{survey_id:s.surveyId,access_token:s.accessToken,field_id:e.data("id"),response_ids:t.join(",")}}).always(function(){clearTimeout(d),a.addClass("hidden")}).done(function(t){var s=e.find(".js-chart-target"),a=e.find(".js-text-target"),n=e.find(".js-chart-type"),d=n.find("select").val();if(e.find(".js-response-count").text(t.response_count),s.data("chart-data",t.data.chart),s.data("chart-type",d),r.removeClass("hidden"),t.data.chart.length>0?(s.trigger("draw"),n.removeClass("hidden"),s.removeClass("hidden")):(n.addClass("hidden"),s.addClass("hidden")),a.empty(),t.data.text.length>0){for(var o=0;o<t.data.text.length;o++){var i=$("<li>").html(t.data.text[o]);a.append(i)}a.removeClass("hidden")}else a.addClass("hidden")}).fail(function(t){var e;try{e=JSON.parse(t.responseText)}catch(s){e={status:500,error:"An unknown error occurred."}}n.html(e.error).removeClass("hidden")})}),s},s.drawChart=function(t){t.empty();var e=t.data("chart-data"),a=t.data("chart-type"),n={height:400,title:""},r=t.closest(".js-field").find(".js-error");if(s.charts[a]){for(var d=0;d<e.length;d++){var o=$("<div>").addClass("media-screen"),i=$("<img>").addClass("media-print");t.append(o).append(i);for(var c=new google.visualization.DataTable,h=0;h<e[d].columns.length;h++)c.addColumn(e[d].columns[h][0],e[d].columns[h][1]);c.addRows(e[d].rows),n.title=e[d].title||"",s.charts[a].draw(o,i,c,n,e)}r.addClass("hidden")}else r.html("Invalid chart type.").removeClass("hidden");return s},s.initCopyButtons=function(){$("button.copy-link").each(function(){var t=$(this),e=new ZeroClipboard(t.get(0));e.on("ready",function(){e.on("aftercopy",function(){t.removeClass("btn-info").addClass("success btn-success"),setTimeout(function(){t.removeClass("success btn-success").addClass("btn-default")},1500)})}),e.on("error",function(){t.hide()})})},s.__construct()};
//# sourceMappingURL=admin.survey.stats.min.js.map
