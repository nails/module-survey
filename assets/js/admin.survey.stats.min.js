var _ADMIN_SURVEY_STATS;_ADMIN_SURVEY_STATS=function(t){var e=this;return e.surveyId=t,e.charts=[],e.__construct=function(){for(var t in window.NAILS.ModuleSurvey.charts)window.NAILS.ModuleSurvey.charts.hasOwnProperty(t)&&e.charts.push(new window.NAILS.ModuleSurvey.charts[t]);$(".js-field .js-chart-type select").each(function(){$(this).empty();for(var t=0;t<e.charts.length;t++)$(this).append($("<option>").val(t).text(e.charts[t].label)).trigger("change")});for(var a=[],r=0;r<e.charts.length;r++)$.merge(a,e.charts[r].packages);return a=a.filter(function(t,e,a){return e===a.indexOf(t)}),google.charts.load("current",{packages:a}),google.charts.setOnLoadCallback(function(){e.loadStats()}),$(".js-response input").on("click",function(){e.loadStats()}),$(".js-chart-target").on("draw",function(){e.drawChart($(this))}),$(".js-chart-type select").on("change",function(){$(this).closest(".js-field").find(".js-chart-target").data("chart-type",$(this).val()).trigger("draw")}),$(window).on("resize",function(){$(".js-chart-target").trigger("draw")}),$(".js-hide-respondents").on("click",function(){$(".js-respondents > *").each(function(){$(this).attr("style","width:"+$(this).outerWidth()+"px!important;")}),$(".js-respondents, .js-stats").addClass("respondents-hidden"),setTimeout(function(){$(".js-chart-target").trigger("draw")},500)}),$(".js-show-respondents").on("click",function(){$(".js-respondents, .js-stats").removeClass("respondents-hidden"),setTimeout(function(){$(".js-respondents > *").removeAttr("style"),$(".js-chart-target").trigger("draw")},500)}),e},e.loadStats=function(){var t=[];return $(".js-response input:checked").each(function(){t.push(parseInt($(this).val(),10))}),t.length>0&&$(".js-field").each(function(){var a=$(this),r=a.find(".js-loading"),s=a.find(".js-error"),n=a.find(".js-targets");s.addClass("hidden");var d=setTimeout(function(){r.removeClass("hidden")},250);$.ajax({url:window.SITE_URL+"api/survey/survey/stats",data:{survey_id:e.surveyId,field_id:a.data("id"),response_ids:t.join(",")}}).always(function(){clearTimeout(d),r.addClass("hidden")}).done(function(t){var e=a.find(".js-chart-target"),r=a.find(".js-text-target"),s=a.find(".js-chart-type"),d=s.find("select").val();if(a.find(".js-response-count").text(t.response_count),e.data("chart-data",t.data.chart),e.data("chart-type",d),n.removeClass("hidden"),t.data.chart.length>0?(e.trigger("draw"),s.removeClass("hidden"),e.removeClass("hidden")):(s.addClass("hidden"),e.addClass("hidden")),r.empty(),t.data.text.length>0){for(var i=0;i<t.data.text.length;i++){var o=$("<li>").text(t.data.text[i]);r.append(o)}r.removeClass("hidden")}else r.addClass("hidden")}).error(function(t){var e;try{e=JSON.parse(t.responseText)}catch(a){e={status:500,error:"An unknown error occurred."}}s.html(e.error).removeClass("hidden")})}),e},e.drawChart=function(t){t.empty();var a=t.data("chart-data"),r=t.data("chart-type"),s={height:400,title:""},n=t.closest(".js-field").find(".js-error");if(e.charts[r]){for(var d=0;d<a.length;d++){var i=$("<div>");t.append(i);for(var o=new google.visualization.DataTable,c=0;c<a[d].columns.length;c++)o.addColumn(a[d].columns[c][0],a[d].columns[c][1]);o.addRows(a[d].rows),s.title=a[d].title||"",e.charts[r].draw(i,o,s,a)}n.addClass("hidden")}else n.html("Invalid chart type.").removeClass("hidden");return e},e.__construct()};
//# sourceMappingURL=admin.survey.stats.min.js.map
