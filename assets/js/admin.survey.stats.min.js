var _ADMIN_SURVEY_STATS;_ADMIN_SURVEY_STATS=function(a){var e=this;return e.surveyId=a,e.__construct=function(){return $(".js-response input").on("click",function(){e.loadStats()}),$(".js-chart-type select").on("change",function(){e.drawChart($(this).closest(".js-field").find(".js-chart-target"),$(this).val())}),google.charts.load("current",{packages:["corechart"]}),google.charts.setOnLoadCallback(function(){e.loadStats()}),e},e.loadStats=function(){var a=[];return $(".js-response input:checked").each(function(){a.push(parseInt($(this).val(),10))}),a.length>0&&$(".js-field").each(function(){var t=$(this),s=t.find(".js-loading"),r=t.find(".js-error"),n=t.find(".js-targets");r.addClass("hidden");var d=setTimeout(function(){s.removeClass("hidden")},250);$.ajax({url:window.SITE_URL+"api/survey/survey/stats",data:{survey_id:e.surveyId,field_id:t.data("id"),response_ids:a.join(",")}}).always(function(){clearTimeout(d),s.addClass("hidden")}).done(function(a){var s=t.find(".js-chart-target"),r=t.find(".js-text-target");t.find(".js-response-count").text(a.response_count),s.data("chart-data",a.data.chart),n.removeClass("hidden");var d=t.find(".js-chart-type"),o=d.find("select").val().toUpperCase();if(console.log(o,a.data.chart.rows),a.data.chart.rows[o].length>0?(e.drawChart(s,o),d.removeClass("hidden"),s.removeClass("hidden")):(d.addClass("hidden"),s.addClass("hidden")),r.empty(),a.data.text.length>0){for(var i=0;i<a.data.text.length;i++){var l=$("<li>").text(a.data.text[i]);r.append(l)}r.removeClass("hidden")}else r.addClass("hidden")}).error(function(a){var e;try{e=JSON.parse(a.responseText)}catch(t){e={status:500,error:"An unknown error occurred."}}r.html(e.error).removeClass("hidden")})}),e},e.drawChart=function(a,t){for(var s=a.data("chart-data"),t=t.toUpperCase(),r=new google.visualization.DataTable,n=0;n<s.columns[t].length;n++)r.addColumn(s.columns[t][n][0],s.columns[t][n][1]);r.addRows(s.rows[t]);var d,o={height:400};switch(t){case"PIE":d=new google.visualization.PieChart(a.get(0));break;case"BAR":d=new google.visualization.BarChart(a.get(0));break;case"COLUMN":d=new google.visualization.ColumnChart(a.get(0))}var i=a.closest(".js-field").find(".js-error");return d?(d.draw(r,o),i.addClass("hidden")):i.html("Invalid chart type.").removeClass("hidden"),e},e.__construct()};
//# sourceMappingURL=admin.survey.stats.min.js.map
