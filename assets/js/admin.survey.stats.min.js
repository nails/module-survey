var _ADMIN_SURVEY_STATS;_ADMIN_SURVEY_STATS=function(e){var t=this;return t.surveyId=e,t.charts=[],t.__construct=function(){for(var e in window.NAILS.ModuleSurvey.charts)window.NAILS.ModuleSurvey.charts.hasOwnProperty(e)&&t.charts.push(new window.NAILS.ModuleSurvey.charts[e]);$(".js-field .js-chart-type select").each(function(){$(this).empty();for(var e=0;e<t.charts.length;e++)$(this).append($("<option>").val(e).text(t.charts[e].label)).trigger("change")});for(var s=[],a=0;a<t.charts.length;a++)$.merge(s,t.charts[a].packages);return s=s.filter(function(e,t,s){return t===s.indexOf(e)}),google.charts.load("current",{packages:s}),google.charts.setOnLoadCallback(function(){t.loadStats()}),$(".js-response input").on("click",function(){t.loadStats()}),$(".js-chart-type select").on("change",function(){t.drawChart($(this).closest(".js-field").find(".js-chart-target"),$(this).val())}),$(".js-hide-respondees").on("click",function(){$(".js-respondees > *").each(function(){$(this).attr("style","width:"+$(this).outerWidth()+"px!important;")}),$(".js-respondees, .js-stats").addClass("respondees-hidden")}),$(".js-show-respondees").on("click",function(){$(".js-respondees, .js-stats").removeClass("respondees-hidden"),setTimeout(function(){$(".js-respondees > *").removeAttr("style")},500)}),t},t.loadStats=function(){var e=[];return $(".js-response input:checked").each(function(){e.push(parseInt($(this).val(),10))}),e.length>0&&$(".js-field").each(function(){var s=$(this),a=s.find(".js-loading"),r=s.find(".js-error"),n=s.find(".js-targets");r.addClass("hidden");var d=setTimeout(function(){a.removeClass("hidden")},250);$.ajax({url:window.SITE_URL+"api/survey/survey/stats",data:{survey_id:t.surveyId,field_id:s.data("id"),response_ids:e.join(",")}}).always(function(){clearTimeout(d),a.addClass("hidden")}).done(function(e){var a=s.find(".js-chart-target"),r=s.find(".js-text-target");s.find(".js-response-count").text(e.response_count),a.data("chart-data",e.data.chart),n.removeClass("hidden");var d=s.find(".js-chart-type"),o=d.find("select").val().toUpperCase();if(e.data.chart.rows[o].length>0?(t.drawChart(a,o),d.removeClass("hidden"),a.removeClass("hidden")):(d.addClass("hidden"),a.addClass("hidden")),r.empty(),e.data.text.length>0){for(var i=0;i<e.data.text.length;i++){var c=$("<li>").text(e.data.text[i]);r.append(c)}r.removeClass("hidden")}else r.addClass("hidden")}).error(function(e){var t;try{t=JSON.parse(e.responseText)}catch(s){t={status:500,error:"An unknown error occurred."}}r.html(t.error).removeClass("hidden")})}),t},t.drawChart=function(e,s){e.empty();var a=e.data("chart-data");s=s.toUpperCase();for(var r=new google.visualization.DataTable,n=0;n<a.columns.length;n++)r.addColumn(a.columns[n][0],a.columns[n][1]);r.addRows(a.rows);var d={height:400},o=e.closest(".js-field").find(".js-error");return t.charts[s]?(t.charts[s].draw(e,r,d,a),o.addClass("hidden")):o.html("Invalid chart type.").removeClass("hidden"),t},t.__construct()};
//# sourceMappingURL=admin.survey.stats.min.js.map
